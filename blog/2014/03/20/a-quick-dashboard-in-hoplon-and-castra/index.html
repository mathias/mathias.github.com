
<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>A quick dashboard in Hoplon &amp; Castra - blog.mattgauger.com</title>
    <meta name="author" content="Matt Gauger">

    
    <meta name="description" content="A Quick Dashboard in Hoplon &amp; Castra Note: I began writing a much longer blog post that went into a ton of detail about how to build an app &hellip;">
    

    <link href="/atom.xml" rel="alternate" title="blog.mattgauger.com" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>


<body>
  <header class="inner"><div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a href="/" class="brand">blog.mattgauger.com</a>

      <div class="nav-collapse">
        <nav class="menu left"><ul class="nav">
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Blog Archives</a></li>
  <li><a href="/open-source">Open Source</a></li>
  <li><a href="/presentations">Presentations</a></li>
  
  <li class="divider-vertical"></li>
  <li><a class="feed" href="http://feeds.feedburner.com/MattGaugerBlog" title="Atom XML/RSS Feed">Atom Feed</a></li>
  
</ul>
</nav>
        <div class="right">
          <form class="navbar-search pull-right" action="http://google.com/search" method="get">
            <input class="input-medium search-query span2" type="text" name="q" results="0" placeholder="Search">
            <input type="hidden" name="q" value="site:blog.mattgauger.com">
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</header>
  <div class="container bottom-left-rounded-corner bottom-right-rounded-corner" id="page-container">
    <div class="row">
  <div class="span8 offset2" id="content">
    <article class="post">
    <h1 class="title">A Quick Dashboard in Hoplon &amp; Castra</h1>
    <div class="entry"><p><em>Note:</em> I began writing a much longer blog post that went into a ton of detail about how to build an app dashboard that used Hoplon and Castra. The kind of dashboard that just consumes JSON API endpoints from another app or other data sources. Such dashboards update on the fly in the browser. Many apps these days need a dashboard like this to monitor stats: worker job queues, database size, average response times, etc.</p>

<p>Rather than that long blog post, I wanted to simply show the steps I would take to build such a dashboard with <a href="http://hoplon.io">Hoplon</a> and <a href="https://github.com/tailrecursion/castra">Castra</a>. I won&#8217;t go into detail here or explain either Hoplon or Castra &mdash; go read on your own first, and also look into <a href="https://github.com/tailrecursion/boot">boot</a>, the build tool this uses.</p>

<p>If you want to follow along, I&#8217;ve provided a <a href="https://github.com/mathias/gleam">repo</a>. The <a href="https://github.com/mathias/gleam/blob/30b4976b313c950c6cc97e64c65036eb21d75378/README.md">README</a> has instructions for getting setup. Assuming you have boot installed, you can just run <code>boot gleam-app</code> to get started.</p>

<p>So here&#8217;s how I&#8217;d build up a dashboard, in several iterations:</p>

<h2>Static data in the browser:</h2>

<p>First, we get some data into the HTML using Hoplon cells:</p>

<script src="https://gist.github.com/mathias/9670739.js"></script>


<p>You&#8217;ll want to <code>git reset --hard 69b070</code> to get to this point.</p>

<h2>Move the data to ClojureScript:</h2>

<p>In <code>src/cljs/gleam/rpc.cljs</code>:</p>

<script src="https://gist.github.com/mathias/9635157.js"></script>


<p>And take out the <code>(def articlesâ€¦)</code> from <code>index.html.hl</code>. After boot recompiles everything, you should still see the data in the page.</p>

<p>To get to this point, you can run <code>git reset --hard d63f299</code>.</p>

<h2>Move the data to the server side</h2>

<p>Change <code>src/cljs/gleam/rpc.cljs</code> again, this time to make a remote call for data:</p>

<script src="https://gist.github.com/mathias/9671172.js"></script>


<p>On the backend, we need something like this in <code>src/castra/gleam/api/gleam.clj</code>:</p>

<script src="https://gist.github.com/mathias/9671200.js"></script>


<p>The Hoplon HTML file changes in the script tag at the top to use the new ClojureScript remote call and start up the polling:</p>

<script src="https://gist.github.com/mathias/9671220.js"></script>


<p>To get to this point in the example repo, you can do <code>git reset --hard 0bad1e5</code>.</p>

<h2>Real time data</h2>

<p>The last step that I will show is to verify that we are in fact getting regular updates of data from the back end.</p>

<p>Change your Castra Clojure file to look like this:</p>

<script src="https://gist.github.com/mathias/9671661.js"></script>


<p>To get to this point, you can do a <code>git reset --hard f19325</code></p>

<h2>Talking to a remote service.</h2>

<p>The last step here is left as an exercise for the reader. You can imagine replacing the <code>articles</code> function in <code>src/castra/gleam/api/gleam.clj</code> with something that polls a remote JSON API for data. Or you could look at my social news app <a href="http://github.com/mathias/gnar">gnar</a> for inspiration on using a Postgres database for data.</p>

<p>I hope to finish up a post with full explanations soon. Castra is relatively new, and it&#8217;s worth explaining how some of the pieces fit together. My explanation should include more complicated interaction. like user authentication. I will be publishing that blog post after I get back from <a href="http://clojurewest.org">ClojureWest</a> next week!</p>

<p>Let me know what you thought of this post by shooting me an <a href="mailto:contact@mattgauger.com">email</a>. I&#8217;d love to hear from you.</p>
</div>

    <div class="meta">
        <div class="author">
  

<span class="byline author vcard">Posted by <span class="fn">Matt Gauger</span>.</span>
</div>
        <div class="date">












<time datetime="2014-03-20T13:29:00-05:00" pubdate  data-updated="true" >Mar 20<span>th</span>, 2014</time>.</div>
        <div class="tags">

</div>
    </div>
</article>
  </div>
</div>

    <hr />
    <footer class="footer"><div class="row">
  <div class="offset2 span2">
    <img src="/images/mathiasx.jpg" alt="portrait">
  </div>
  <div class="span3">
    <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />
blog.mattgauger.com
by <a href="http://blog.mattgauger.com">Matt Gauger</a> is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
</p>

  </div>
  <div class="offset1 span3">
    <ul class="nav nav-list">
      <li><a href="https://github.com/mathias">Github</a></li>
      <li><a href="/presentations">Presentations</a></li>
      <li><a href="http://feeds.feedburner.com/MattGaugerBlog" title="Atom XML/RSS Feed">Atom Feed</a></li>
    </ul>
  </div>
</div>
</footer>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script src="/javascripts/bootstrap-alert.js"></script>
<script src="/javascripts/bootstrap-button.js"></script>
<script src="/javascripts/bootstrap-collapse.js"></script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38944731-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
