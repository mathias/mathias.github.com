
<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Minsky's Circle Algorithm in Shoes.rb / Hackety Hack - blog.mattgauger.com</title>
    <meta name="author" content="Matt Gauger">

    
    <meta name="description" content="Minsky's Circle Algorithm in Shoes.rb / Hackety Hack (This post is part of my blog archiving project. This post appeared on Coderwall on July 27, &hellip;">
    

    <link href="/atom.xml" rel="alternate" title="blog.mattgauger.com" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>


<body>
  <header class="inner"><div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a href="/" class="brand">blog.mattgauger.com</a>

      <div class="nav-collapse">
        <nav class="menu left"><ul class="nav">
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Blog Archives</a></li>
  <li><a href="/open-source">Open Source</a></li>
  <li><a href="/presentations">Presentations</a></li>
  
  <li class="divider-vertical"></li>
  <li><a class="feed" href="http://feeds.feedburner.com/MattGaugerBlog" title="Atom XML/RSS Feed">Atom Feed</a></li>
  
</ul>
</nav>
        <div class="right">
          <form class="navbar-search pull-right" action="http://google.com/search" method="get">
            <input class="input-medium search-query span2" type="text" name="q" results="0" placeholder="Search">
            <input type="hidden" name="q" value="site:blog.mattgauger.com">
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</header>
  <div class="container bottom-left-rounded-corner bottom-right-rounded-corner" id="page-container">
    <div class="row">
  <div class="span8 offset2" id="content">
    <article class="post">
    <h1 class="title">Minsky's Circle Algorithm in Shoes.rb / Hackety Hack</h1>
    <div class="entry"><hr />

<p><em>(This post is part of my blog archiving project. This post appeared on <a href="https://coderwall.com/p/fukypa">Coderwall</a> on July 27, 2013.)</em></p>

<hr />

<p>I wanted to try to implement Minsky&#8217;s Circle Algorithm from the famous <a href="http://en.wikipedia.org/wiki/HAKMEM">HAKMEM</a>. As noted in lots of other places online (<a href="http://brainwagon.org/2010/08/09/drawing-circles-ala-marvin-minsky/">1</a>, <a href="https://news.ycombinator.com/item?id=3111501">2</a>, <a href="http://cabezal.com/misc/minsky-circles.html">3</a>), the algorithm doesn&#8217;t plot a true circle, but rather a very round ellipse. Here&#8217;s the text from the HAKMEM entry:</p>

<blockquote><p>ITEM 149 (Minsky): CIRCLE ALGORITHM Here is an elegant way to draw almost circles on a point-plotting display:</p>

<blockquote><p>&nbsp;&nbsp;&nbsp;NEW X = OLD X - epsilon * OLD Y</p>

<p>&nbsp;&nbsp;&nbsp;NEW Y = OLD Y + epsilon * NEW(!) X</p></blockquote>

<p>This makes a very round ellipse centered at the origin with its size determined by the initial point. epsilon determines the angular velocity of the circulating point, and slightly affects the eccentricity. If epsilon is a power of 2, then we don&#8217;t even need multiplication, let alone square roots, sines, and cosines! The &#8220;circle&#8221; will be perfectly stable because the points soon become periodic.</p>

<p>The circle algorithm was invented by mistake when I tried to save one register in a display hack! Ben Gurley had an amazing display hack using only about six or seven instructions, and it was a great wonder. But it was basically line-oriented. It occurred to me that it would be exciting to have curves, and I was trying to get a curve display hack with minimal instructions.</p></blockquote>

<p>The benefit of using this algorithm, at the time, was that it doesn&#8217;t use cosine/sine or any other complicated functions, and so could be implemented on the rather-limited computers of that time to draw circles fast. (I believe it was used to draw the orbits of ships on the early game <a href="http://en.wikipedia.org/wiki/Spacewar_(video_game">SpaceWar</a>, but I don&#8217;t know that for sure.)</p>

<p>To implement it myself, I needed to be able to plot points on a display. So I turned to Hackety-Hack, which comes with Shoes for drawing graphics. The Shoes DSL for drawing shapes is rather simple, which means we can take the pseudocode above and turn it into a working demo rather easily:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Shoes</span><span class="o">.</span><span class="n">app</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">epsilon</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="mi">16</span>
</span><span class='line'>  <span class="n">offset</span> <span class="o">=</span> <span class="mi">250</span>
</span><span class='line'>  <span class="n">x</span> <span class="o">=</span> <span class="mi">20</span>
</span><span class='line'>  <span class="n">y</span> <span class="o">=</span> <span class="mi">20</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">fill</span> <span class="n">red</span>
</span><span class='line'>  <span class="n">shape</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">move_to</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span><span class="n">y</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="mi">100</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">y</span>
</span><span class='line'>      <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">x</span>
</span><span class='line'>      <span class="n">line_to</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span><span class="n">y</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">fill</span> <span class="n">blue</span>
</span><span class='line'>  <span class="n">oval</span><span class="p">({</span><span class="ss">top</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="ss">left</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span> <span class="ss">radius</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="ss">center</span><span class="p">:</span> <span class="kp">true</span><span class="p">})</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Epsilon is 1/16, as indicated by some quick googling &#8211; basically a small power of two. I have to use the offset to get the center of the circle closer to the center of the Shoes window &#8211; without the offset, the circle will only be a quarter-circle in the upper left corner.</p>

<h2>How does this compare to plotting a real circle?</h2>

<p>If we want to compare the roundness of our &#8220;circle&#8221; to a real circle drawn by Shoes, we can add this line in before the closing <code>end</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">fill</span> <span class="n">blue</span>
</span><span class='line'>  <span class="n">oval</span><span class="p">({</span><span class="ss">top</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="ss">left</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span> <span class="ss">radius</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="ss">center</span><span class="p">:</span> <span class="kp">true</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Although their radiuses are going to be slightly different.</p>

<p>Here&#8217;s what we end up with. Minsky&#8217;s Circle Algorithm on the left in red, a real circle on the right in blue:</p>

<p><img src="http://www.mattgauger.com/img//Shoes-20130727-151954.jpg" alt="Hackety Hack" /></p>
</div>

    <div class="meta">
        <div class="author">
  

<span class="byline author vcard">Posted by <span class="fn">Matt Gauger</span>.</span>
</div>
        <div class="date">












<time datetime="2013-07-27T11:32:00-05:00" pubdate  data-updated="true" >Jul 27<span>th</span>, 2013</time>.</div>
        <div class="tags">

</div>
    </div>
</article>
  </div>
</div>

    <hr />
    <footer class="footer"><div class="row">
  <div class="offset2 span2">
    <img src="/images/mathiasx.jpg" alt="portrait">
  </div>
  <div class="span3">
    <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />
blog.mattgauger.com
by <a href="http://blog.mattgauger.com">Matt Gauger</a> is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
</p>

  </div>
  <div class="offset1 span3">
    <ul class="nav nav-list">
      <li><a href="https://github.com/mathias">Github</a></li>
      <li><a href="/presentations">Presentations</a></li>
      <li><a href="http://feeds.feedburner.com/MattGaugerBlog" title="Atom XML/RSS Feed">Atom Feed</a></li>
    </ul>
  </div>
</div>
</footer>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script src="/javascripts/bootstrap-alert.js"></script>
<script src="/javascripts/bootstrap-button.js"></script>
<script src="/javascripts/bootstrap-collapse.js"></script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38944731-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
