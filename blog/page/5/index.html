
<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>blog.mattgauger.com</title>
    <meta name="author" content="Matt Gauger">

    
    <meta name="description" content="Find Naughty Naughty Model Calls in Your Views (This post is part of my blog archiving project. This post appeared on Coderwall on January 24, 2013 &hellip;">
    

    <link href="/atom.xml" rel="alternate" title="blog.mattgauger.com" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>


<body>
  <header class="inner"><div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a href="/" class="brand">blog.mattgauger.com</a>

      <div class="nav-collapse">
        <nav class="menu left"><ul class="nav">
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Blog Archives</a></li>
  <li><a href="/presentations">Presentations</a></li>
  
  <li class="divider-vertical"></li>
  <li><a class="feed" href="/atom.xml" title="Atom XML/RSS Feed">Atom Feed</a></li>
  
</ul>
</nav>
        <div class="right">
          <form class="navbar-search pull-right" action="http://google.com/search" method="get">
            <input class="input-medium search-query span2" type="text" name="q" results="0" placeholder="Search">
            <input type="hidden" name="q" value="site:blog.mattgauger.com">
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</header>
  <div class="container bottom-left-rounded-corner bottom-right-rounded-corner" id="page-container">
    <div class="row">
  <article class="page span8 offset2">
    
    


  <article class="post">
    
    <h1 class="title"><a href="/blog/2013/01/24/find-naughty-naughty-model-calls-in-your-views/">Find Naughty Naughty Model Calls in Your Views</a></h1>
    <div class="entry">
        <hr />

<p><em>(This post is part of my blog archiving project. This post appeared on <a href="https://coderwall.com/p/33siha">Coderwall</a> on January 24, 2013.)</em></p>

<hr />

<p>I found this really helpful in a project where almost all the views were requesting things from the database rather than letting the controller handle it.</p>

<p>I&#8217;ve got a couple little regexes with various levels of specificity to help you seek and destroy!</p>

<p>In vim with Fugitive, run:</p>

<pre><code>:Ggrep "(&lt;%|=|-).*[A-Z].*\.(find|order|where|includes|all)" app/views/
</code></pre>

<p>This will find places where someone is using model classes with queries in your views. This should work for both erb and haml views. You&#8217;ll probably get a few false matches (I eliminated the common ones like capitalized link titles in a link_to call, for example), but overall I was able to reduce a ton of naughty code.</p>

<p>If you want to catch other annoying things (like using Time.now calls), you can look for what should be classes used in views:</p>

<pre><code>:Ggrep "(&lt;%|=|-).*[A-Z].*\." app/views
</code></pre>

<p>If you want to be even simpler, you could just look for those ActiveRelation queries:</p>

<pre><code>:Ggrep "(find|order|where|includes|all)" app/views/
</code></pre>

<p>These also both work from the command line (if you don&#8217;t have Fugitive in your vim yet) by replacing :Ggrep with git-grep:</p>

<pre><code>git-grep "(find|order|where|includes|all)" app/views/
</code></pre>

<p>With these tools in your belt, you can find all those calls to the database in your views and improve your Rails app.</p>

<p>Let me know if this tip was helpful at @mathiasx on Twitter!</p>

        
        
    </div>

    <div class="meta">
        <div class="author">
  

<span class="byline author vcard">Posted by <span class="fn">Matt Gauger</span>.</span>
</div>
        <div class="date">












<time datetime="2013-01-24T11:32:00-06:00" pubdate  data-updated="true" >Jan 24<span>th</span>, 2013</time>.</div>
        <div class="tags">

</div>
    </div>

  </article>


  <article class="post">
    
    <h1 class="title"><a href="/blog/2012/12/25/find-a-unique-name-for-your-project/">Find a Unique Name for Your Project</a></h1>
    <div class="entry">
        <hr />

<p><em>(This post is part of my blog archiving project. This post appeared on <a href="https://coderwall.com/p/vmz1xq">Coderwall</a> on December 25, 2012.)</em></p>

<hr />

<pre><code>grep ".*a.*b.*c.*" /usr/share/dict/words
</code></pre>

<p>where the pattern is the letters you want with anything in-between.</p>

        
        
    </div>

    <div class="meta">
        <div class="author">
  

<span class="byline author vcard">Posted by <span class="fn">Matt Gauger</span>.</span>
</div>
        <div class="date">












<time datetime="2012-12-25T11:32:00-06:00" pubdate  data-updated="true" >Dec 25<span>th</span>, 2012</time>.</div>
        <div class="tags">

</div>
    </div>

  </article>


  <article class="post">
    
    <h1 class="title"><a href="/blog/2012/07/13/run-rake-just-run-rake/">Run Rake. Just Run Rake.</a></h1>
    <div class="entry">
        <p>Recently, I was setting up my laptop for an existing Rails project with the help of a pair. My pair was pivot on this project, which means that he&#8217;d been on it longer and so was bringing his experience and knowledge to the table, while I was seeing the project with fresh eyes.</p>

<p>&#8220;This is going to take forever to set up,&#8221; he grumbled. &#8220;The documentation&#8217;s out of date, and I remember there&#8217;s a bunch of gotchas to setting this project up. We&#8217;ll need to compile this, then do that, then you get an API key for..&#8221;</p>

<p>I went to Github and cloned the repo to my laptop.</p>

<p>&#8220;Just run rake,&#8221; I replied.</p>

<p>&#8220;What?&#8221;</p>

<p>&#8220;Just run rake. It will tell us what to do next.&#8221;</p>

<p>And indeed, it did tell us what to do. I&#8217;ve called this test-based configuration, or other funny things in the past, but you can just think of it as trying to get to a known good state - a state where all the tests run. If it prevents the tests from running, then it&#8217;s the next thing you need.</p>

<p>I had to silence my pair&#8217;s grumbling at this process, because at first it seems like you&#8217;re going to be waiting a lot for rake, and that it might be easier just to remember all the steps necessary to set up a project.</p>

<p>It turns out rake showed us all the steps we needed to do to get the project running. A full log of what this looks like setting up a simple Rails app can be seen <a href="https://gist.github.com/3112558">in this gist</a>.</p>

<h3>Why?</h3>

<p>The point of software craftsmanship is to be pragmatic, not to seek perfection. I could have memorized the steps necessary to set up the average Rails project, but those steps wouldn&#8217;t have applied here. And indeed, my pair could have memorized them, since he had been on the project. But those steps would go out the window as soon as my pair was on another project. It is far more pragmatic to know the behavior of our tools (like knowing that rake will tell us about each thing necessary to get to a state where the tests pass) and rely on that behavior rather than to seek perfection on this one project.</p>

<p>Note: we could have used our experience with Rails and software craftsmen to avoid some of the steps you see me running in the gist: for example, you probably know that if the databases aren&#8217;t created, that you can run <code>rake db:create:all db:migrate db:test:prepare</code> all at once, without running rake inbetween every single rake task. That&#8217;d be far more pragmatic, as you&#8217;re saving yourself time and effort by knowing the toolset. But I wanted to demonstrate that running rake between every single step told us what to do next.</p>

<p>Now, ask yourself: How can you &#8220;just run rake&#8221; with your projects?</p>

        
        
    </div>

    <div class="meta">
        <div class="author">
  

<span class="byline author vcard">Posted by <span class="fn">Matt Gauger</span>.</span>
</div>
        <div class="date">












<time datetime="2012-07-13T14:59:00-05:00" pubdate  data-updated="true" >Jul 13<span>th</span>, 2012</time>.</div>
        <div class="tags">

</div>
    </div>

  </article>


  <article class="post">
    
    <h1 class="title"><a href="/blog/2012/04/21/mosh-ssh-tunnels-tmux/">Mosh, SSH Tunnels, and Tmux</a></h1>
    <div class="entry">
        <p>I&#8217;m currently preparing for RailsConf. One of the things I wanted to do before I left was figure out a way to monitor a process on a Linux server running on my LAN. The process frequently crashes and needs some prodding to restart.</p>

<p>One solution might be to set up DynDNS and configure the router to point from some random port to the SSH port on the Linux machine running on the LAN. That idea didn&#8217;t strike my fancy, as it just isn&#8217;t terribly secure to open up a port to the entire world, and it seems that DynDNS costs money to use since 2008. I&#8217;m sure there are free alternatives, but I couldn&#8217;t be bothered to find them, much less configure them.</p>

<p>A much better solution would be an SSH tunnel up to my Linode, and a reverse tunnel back down to the Linux server on my LAN. If you haven&#8217;t used reverse SSH tunneling before, it is really neat. Here&#8217;s an example:</p>

<p>From the local server:</p>

<pre><code>ssh -R 2048:localhost:22 username@example.com
</code></pre>

<p>From the server out in the Internet (aka example.com in this example)</p>

<pre><code>ssh -p 2048 other_username@localhost
</code></pre>

<p>Note that the &#8216;localhost&#8217; in the second example refers to your local server, not the one out in the internet. So <code>other_username</code> should be the username on your local server (not the remote server.) Confused yet? Good.</p>

<p>Now, this setup will get you pretty far: You&#8217;re now able to run commands on the local server from the Linode out in the cloud. But you may notice a problem fairly quickly: if you kill that SSH shell on the local server, the connection up to the server on the internet dies, and so does the reverse tunnel that was inside that.</p>

<p>Fix that by starting up a tmux session on the local server first, then detaching it.</p>

<pre><code>tmux new -s ssh-tunnel
ssh -R 2048:localhost:22 username@example.com
&lt;leader-d&gt;
</code></pre>

<p>Now the tmux session will happily keep that SSH shell open on the local server and you can reverse tunnel back over it.</p>

<p>My solution involves <a href="http://mosh.mit.edu">Mosh</a>, which I&#8217;ve been using quite a bit since it exploded on Hacker News and other news sites. Simply put, Mosh is like SSH, but it uses UDP packets to make itself more reliable. &#8220;More reliable without TCP?&#8221; you say? Well, Mosh is doing a little more work to buffer the connection to the other machine (including instant response to typing when there&#8217;d otherwise be lag) and maintains that connection: even if you change IPs, hop on a train, etc. It&#8217;s pretty amazing, and so far I&#8217;ve been loving it. Click through to the Mosh site to read up more on it. It really is awesome.</p>

<p>With Mosh, we add another layer to the puzzle, so that my final setup looked like this:</p>

<pre><code>matts_laptop$ mosh matt@someserver.local
matt@someserver.local$ tmux new -s ssh-tunnel
&lt;tmux session starts&gt;
matt@someserver.local$ ssh -R 2048:localhost:22 username@example.com
&lt;leader-d&gt;
</code></pre>

<p>Pop open another window in my local tmux session (are you beginning to see a pattern?) and then connect with mosh up to my Linode:</p>

<pre><code>matts_laptop$ mosh me@mattgauger.com
me@mattgauger.com$ tmux new -s server-monitor
&lt;tmux session starts&gt;
me@mattgauger.com$ ssh -p 2048 matt@localhost # Note: this is the matt@someserver.local account!
matt@someserver.local$ &lt;monitor the process I'm concerned with&gt;
</code></pre>

<p>Now I&#8217;ve got this mostly-persistent (thanks to mosh and tmux) session that I can detach from if I really need to, but I&#8217;ll still be able to connect back up to my Linode and check on the server on my LAN from RailsConf.</p>

<p>Pretty cool, huh?</p>

        
        
    </div>

    <div class="meta">
        <div class="author">
  

<span class="byline author vcard">Posted by <span class="fn">Matt Gauger</span>.</span>
</div>
        <div class="date">












<time datetime="2012-04-21T21:14:00-05:00" pubdate  data-updated="true" >Apr 21<span>st</span>, 2012</time>.</div>
        <div class="tags">

</div>
    </div>

  </article>


  <article class="post">
    
    <h1 class="title"><a href="/blog/2012/04/13/announcing-a-new-virtual-book-club-the-diamond-age/">Announcing a Virtual Book Club: The Diamond Age</a></h1>
    <div class="entry">
        <p><img src="/images/The_Diamond_Age.jpg" alt="The Diamond Age book cover" /></p>

<p>Recently I decided that it&#8217;s time to re-read The Diamond Age by Neal Stephenson. But, without external motivators, the list of books that I&#8217;d like to read grows and grows, and reading books actual takes me a lot longer than it should. (Because, well, the internet is so damn interesting, and I haven&#8217;t finished reading that.)</p>

<p>So I&#8217;m trying an experiment. I am proposing to hold a book club, online, so that I will read The Diamond Age again. My current plan is to use Google Plus Hangouts and hold weekly online meetings to discuss progress in the book. I&#8217;ve never really run a book club on my own before, so we&#8217;ll see where this goes.</p>

<p>If you&#8217;re interested, please indicate that interest by signing up below. I&#8217;ll use the sign ups to plan and gauge when to start.</p>

<h3><a href="https://docs.google.com/spreadsheet/viewform?formkey=dFBBNUJZcUZuX1Q3Uk5VbGRVRVNsQ3c6MQ#gid=0">Sign up form</a></h3>

<p></p>


<p>Get The Diamond Age: (non-affiliate links)</p>

<ul>
<li><a href="http://www.amazon.com/The-Diamond-Age-Illustrated-Spectra/dp/0553380966/">Paperback</a></li>
<li><a href="http://www.amazon.com/Diamond-Bantam-Spectra-Book-ebook/dp/B000FBJCKI/">Kindle Edition</a></li>
</ul>


        
        
    </div>

    <div class="meta">
        <div class="author">
  

<span class="byline author vcard">Posted by <span class="fn">Matt Gauger</span>.</span>
</div>
        <div class="date">












<time datetime="2012-04-13T15:29:00-05:00" pubdate  data-updated="true" >Apr 13<span>th</span>, 2012</time>.</div>
        <div class="tags">

</div>
    </div>

  </article>


<ul class="pager">
  
    <li>
    <a href="/blog/page/4/" class="prev">Prev</a>
    </li>
  
  
    <li>
    <a href="/blog/page/6/" class="next">Next</a>
    </li>
  
</ul>

<a href="/blog/archives" class="center">
  <i class="icon-th-list"></i> 
  Blog Archives
</a>

  </article>
</div>

    <hr />
	  <footer class="footer"><div class="row">
  <div class="offset2 span2">
    <img src="/images/mathiasx.jpg" alt="portrait">
  </div>
  <div class="span3">
    <p><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="https://github-camo.global.ssl.fastly.net/cc898278e77203243a0b63be665d38fa75dcf04a/687474703a2f2f692e6372656174697665636f6d6d6f6e732e6f72672f6c2f62792d6e632d73612f332e302f38387833312e706e67" alt="Creative Commons License Image" data-canonical-src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" style="max-width:100%;"></a>
blog.mattgauger.com
by <a href="http://blog.mattgauger.com">Matt Gauger</a> is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons
Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>

  </div>
  <div class="offset1 span3">
    <ul class="nav nav-list">
      <li><a href="https://github.com/mathias">Github</a></li>
      <li><a href="/presentations">Presentations</a></li>
      <li><a href="/atom.xml" title="Atom XML/RSS Feed">Atom Feed</a></li>
    </ul>
  </div>
</div>
</footer>
  </div>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script src="/javascripts/bootstrap-alert.js"></script>
<script src="/javascripts/bootstrap-button.js"></script>
<script src="/javascripts/bootstrap-collapse.js"></script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38944731-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
